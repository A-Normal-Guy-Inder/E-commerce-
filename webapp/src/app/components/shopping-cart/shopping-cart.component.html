<div *ngIf="orderStep==0" class="min-h-screen bg-[#E3FDFD] p-6">
  <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl p-6">
    <h1 class="text-3xl font-semibold text-[#71C9CE] mb-6">Shopping Cart</h1>

    <!-- EMPTY CART -->
    <div *ngIf="cartService.items.length === 0" class="text-center py-20 text-[#113f67]">
      <img src="/images/emptycart.png" alt="Empty Cart" class="w-32 h-32 mx-auto mb-6 opacity-60">
      <p class="text-xl font-semibold mb-2">Your cart is empty!</p>
      <p class="text-sm text-gray-500">Looks like you haven’t added anything to your cart yet.</p>
    </div>

    <!-- CART ITEMS + SUMMARY -->
    <div *ngIf="cartService.items.length > 0">
      <!-- CART ITEMS LIST -->
      <div class="space-y-6">
        <div *ngFor="let item of cartService.items" class="flex flex-col sm:flex-row sm:items-center justify-between border-b pb-4">
          <div class="flex items-center gap-4">
            <img src="{{item.product.images[0]}}" alt="Product Image" class="w-24 h-24 object-cover rounded-xl border">
            <div>
              <h3 class="text-lg font-semibold text-[#113f67]">{{item.product.name}}</h3>
              <p class="text-[#555] text-sm">{{item.product.shortDescription}}</p>
              <div class="flex item-center gap-1 mt-2">
                <span class="text-lg font-semibold text-cyan-600">₹{{sellingPrice(item.product) * item.quantity}}</span>
                <div *ngIf="item.product.discount!=0" class="flex item-center gap-1">
                  <span class="text-md text-gray-400 mt-1"><s>₹{{item.product.Price * item.quantity}}</s></span>
                  <span class="text-sm text-orange-400 mt-1">{{item.product.discount}}% off</span>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4 sm:mt-0 flex items-center gap-3">
            <button (click)="addToCart(item.product._id!, -1)" class="w-8 h-8 bg-[#CBF1F5] rounded-full text-lg font-bold hover:bg-[#A6E3E9]">−</button>
            <span class="text-lg font-medium">{{item.quantity}}</span>
            <button (click)="addToCart(item.product._id!, 1)" class="w-8 h-8 bg-[#CBF1F5] rounded-full text-lg font-bold hover:bg-[#A6E3E9]">+</button>
            <button (click)="removeFromCart(item.product)" class="ml-4 text-red-500 hover:underline text-sm">Remove</button>
          </div>
        </div>
      </div>

      <!-- CART SUMMARY -->
      <div class="mt-10 bg-[#CBF1F5] rounded-xl p-6 shadow-inner">
        <h2 class="text-2xl font-semibold text-[#113f67] mb-4">Cart Summary</h2>
        <div class="space-y-2 text-[#113f67]">
          <div class="flex justify-between">
            <span>Subtotal</span>
            <span>₹{{getSubAmount()}}</span>
          </div>
          <div class="flex justify-between">
            <span>Tax (12%)</span>
            <span>₹{{tax}}</span>
          </div>
          <div class="flex justify-between font-bold text-lg">
            <span>Total</span>
            <span>₹{{totalAmount}}</span>
          </div>
        </div>
        <button (click)="checkout()" class="mt-6 w-full py-3 bg-[#71C9CE] text-white rounded-xl hover:bg-cyan-500 transition">
          Proceed to Checkout
        </button>
      </div>
    </div>
  </div>
</div>


<div *ngIf="orderStep == 1" class="min-h-screen bg-[#E3FDFD] flex items-center justify-center px-4">
  <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 mt-10 mb-10">
    <h3 class="text-2xl font-bold text-center text-[#71C9CE] mb-6">Your Order Address</h3>

    <form [formGroup]="addressForm" (ngSubmit)="addAddress()" class="space-y-4" novalidate>
      <!-- Address Line 1 -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Address Line 1</label>
        <input type="text" formControlName="address1"
               class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#A6E3E9]" />
        <div *ngIf="addressForm.get('address1')?.invalid && addressForm.get('address1')?.touched"
             class="text-red-500 text-sm mt-1">
          <div *ngIf="addressForm.get('address1')?.errors?.['required']">Address Line 1 is required</div>
        </div>
      </div>

      <!-- Address Line 2 -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Address Line 2</label>
        <input type="text" formControlName="address2"
               class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#A6E3E9]" />
      </div>

      <!-- City -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
        <input type="text" formControlName="city"
               class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#A6E3E9]" />
        <div *ngIf="addressForm.get('city')?.invalid && addressForm.get('city')?.touched"
             class="text-red-500 text-sm mt-1">
          <div *ngIf="addressForm.get('city')?.errors?.['required']">City is required</div>
        </div>
      </div>

      <!-- Pincode -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Pincode</label>
        <input type="text" formControlName="pincode"
               class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#A6E3E9]" />
        <div *ngIf="addressForm.get('pincode')?.invalid && addressForm.get('pincode')?.touched"
             class="text-red-500 text-sm mt-1">
          <div *ngIf="addressForm.get('pincode')?.errors?.['required']">Pincode is required</div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="pt-4">
        <button type="submit"
                [disabled]="addressForm.invalid"
                class="w-full bg-[#71C9CE] hover:bg-cyan-500 text-white font-semibold py-2 rounded-xl transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
          Continue
        </button>
      </div>
    </form>
  </div>
</div>


<div *ngIf="orderStep == 2" class="min-h-screen bg-[#E3FDFD] flex items-center justify-center px-4">
  <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8">
    <h3 class="text-2xl font-bold text-center text-[#71C9CE] mb-6">Select Payment Method</h3>

    <form class="space-y-6" (ngSubmit)="completeOrder()">
      <!-- Cash on Delivery Option -->
      <mat-radio-group [(ngModel)]="paymentType" name="paymentType" class="space-y-4 block">
        <!-- Cash on Delivery -->
        <mat-radio-button value="cod" class="flex items-center space-x-3" color="warn">
          <span class="ml-2 text-gray-700 text-sm font-medium">Cash on Delivery</span>
        </mat-radio-button>

        <!-- Card (Disabled) -->
        <mat-radio-button value="card" disabled class="flex items-center space-x-3 opacity-50" color="warn">
          <span class="ml-2 text-gray-700 text-sm font-medium">Card (Not available right now)</span>
        </mat-radio-button>
      </mat-radio-group>

      <!-- Place Order Button -->
      <div class="pt-4">
        <button type="submit"
                class="w-full bg-[#71C9CE] hover:bg-cyan-500 text-white font-semibold py-2 rounded-xl transition duration-200">
          Place Order
        </button>
      </div>
    </form>
  </div>
</div>
